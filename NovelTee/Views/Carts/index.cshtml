@model NovelTee.ViewModels.CartViewModel

@{
    ViewBag.Title = "Cart";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@using NovelTee.Models;

<h2>Your Cart</h2>

@if (Session["cart"] == null)
{
    <text>There are no items in you cart.</text>
}
else
{
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th></th>
                <th>Product</th>
                <th>Unit</th>
                <th>Qty</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>

            @foreach (CartItems item in (List<CartItems>)Session["cart"])
            {
                foreach (Product p in Model.Product)
                {
                    if (p.Id == item.Product.Id)
                    {
                        <tr>
                            <td>
                                <img src="@p.ImagePath.Replace("~", "")" width="150" />
                            </td>
                            <td>
                                <h5>@Html.ActionLink(p.Name, "Product", "Products", new { id = p.Id }, null)</h5>

                                @foreach (TeeVariant t in Model.TeeVariant)
                                {
                                    if (t.Id == item.TeeVariant.Id)
                                    {
                                        @Html.Label(p.Category.Cat_Name)<br />
                                        @Html.Label(t.Gender.Name + " " + t.Size.Name)<br />
                                        @Html.Label(t.Color.Name)<br />
                                        break;
                                    }
                                }
                                <a href="@Url.Action("Remove", "Carts", new { @prodId = item.Product.Id, @varId = item.TeeVariant.Id })">Remove</a>
                            </td>
                            <td>@p.Price</td>
                            <td>
                                @foreach (TeeVariant t in Model.TeeVariant)
                                {
                                    if (t.Id == item.TeeVariant.Id)
                                    {
                                        @*@Html.Label(t.Quantity.ToString())
                                        
                                        @Html.DropDownList("Quantity", Enumerable.Range(1, t.Quantity).Select(i => new SelectListItem { Text = i.ToString(), Value = i.ToString()}))*@

                                        using (Html.BeginForm("Update", "Carts", FormMethod.Post))
                                        {
                                            @Html.Hidden("prodId", item.Product.Id);
                                            @Html.Hidden("varId", item.TeeVariant.Id);
                                            <select id="qty" name="qty">
                                                @for (int i = 0; i <= t.Quantity; i++)
                                                {
                                                    string s = "";
                                                    if (i == item.Quantity)
                                                    {
                                                        s = "selected";
                                                    };

                                                    <option value="@i" @s>@i</option>
                                                }
                                            </select>
                                            @Html.Hidden("hiddenQty");

                                            <button type="submit" class="btn-link">Update</button>
                                        }
                                        break;
                                    }
                                }
                                
                            </td>
                            <td>@(p.Price * item.Quantity)</td>
                        </tr>
                        break;
                    }
                }
            }
        </tbody>
    </table>
    <div class="cart-total">
        <h3>Total</h3>
        @{
            decimal total = 0;
            List<CartItems> cart = (List<CartItems>)Session["cart"];
            foreach (var item in cart)
            {
                foreach (var p in Model.Product)
                {
                    if (item.Product.Id == p.Id)
                    {
                        total += (item.Quantity * p.Price);
                    }
                }
            }
        }
        @string.Format("{0:c}", total)
    </div>
}

@section scripts{
    <script>
        
        $(function () {
            $('#qty').change(function () {
                var x = $(this).val();
                $('#hiddenQty').val(x);
            });
        });


    </script>


    }